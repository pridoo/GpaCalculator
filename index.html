<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GPA Calculator</title>

  <script>
    if (localStorage.theme === 'dark') {
      document.documentElement.classList.add('dark');
    }
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  
  <link rel="stylesheet" href="gpa-calcu.css" />


</head>
<body class="min-h-screen bg-white dark:bg-[var(--dark-bg)] text-gray-900 dark:text-[var(--dark-text)] transition-soft p-4 sm:p-6 md:p-10 leading-relaxed">

  <div class="flex justify-center items-start">
    <div 
      x-data="gwaApp()" 
      x-init="init()" 
      class="force-dark-bg w-full max-w-6xl p-6 sm:p-10 text-black dark:text-white shadow-2xl rounded-3xl border border-gray-500 dark:border-gray-900 transition-soft"
    >

      <div class="flex flex-wrap justify-between items-center gap-4 mb-6">
        <h1 class="heading-title text-3xl font-bold text-center sm:text-left w-full sm:w-auto flex-1 leading-relaxed">
          GPA Calculator
        </h1>

        <div @click="toggleTheme" class="toggle-switch relative">
          <div 
            class="toggle-thumb"
            :style="theme === 'dark' ? 'left:32px' : 'left:2px'"
          >
            <span x-text="theme === 'dark' ? '🌙' : '☀️'"></span>
          </div>
        </div>
      </div>


      <div class="mb-10">
        <div class="card rounded-2xl shadow-md border p-6 text-center max-w-md mx-auto leading-relaxed bg-gray-100 dark:bg-[var(--dark-card)]" >
          <div class="text-xl font-semibold mb-2 leading-relaxed">Overall GPA</div>
          <div
            class="text-5xl font-extrabold tracking-wide mb-3"
            :class="{
              'text-yellow-500': overallGWA && overallGWA <= 1.75,
              'text-blue-500': !overallGWA || overallGWA > 1.75
            }"
            x-text="overallGWA || '0.00'"
          ></div>
          <div class="text-lg font-medium" x-text="honorText"></div>
        </div>
      </div>

      <template x-for="(year, yearIndex) in years" :key="year.id">
        <div class="card rounded-xl border p-5 mb-8 shadow-sm transition-soft leading-relaxed bg-gray-100 dark:bg-[var(--dark-card)]">

          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold leading-relaxed" x-text="getOrdinalYear(yearIndex + 1) + ' Year'"></h2>
            <button
              @click="addSubject(yearIndex)"
              class="button text-sm px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-soft"
            >
              ➕ Add Subject
            </button>
          </div>

        <template x-for="(subject, subjIndex) in year.subjects" :key="subject.id">
        <div class="grid grid-cols-1 sm:grid-cols-12 gap-3 mb-3 items-center leading-relaxed">
            <input
            type="text"
            x-model="subject.name"
            placeholder="e.g. Intech 1100"
            class="input sm:col-span-5 px-3 py-2 rounded-lg border w-full"
            />

            <!-- Grade Dropdown -->
            <select
            x-model="subject.grade"
            @change="calculateOverallGWA()"
            class="select sm:col-span-3 px-3 py-2 w-full border border-gray-300 dark:border-[var(--dark-border)] bg-white dark:bg-[var(--dark-card)] text-black dark:text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
            <option value="" disabled selected class="text-gray-400 italic">Select Grade</option>
            <template x-for="grade in grades" :key="grade">
                <option :value="grade" x-text="grade"></option>
            </template>
            </select>

            <!-- Units Dropdown -->
            <select
            x-model="subject.units"
            @change="calculateOverallGWA()"
            class="select sm:col-span-3 px-3 py-2 w-full border border-gray-300 dark:border-[var(--dark-border)] bg-white dark:bg-[var(--dark-card)] text-black dark:text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
            <option value="" disabled selected class="text-gray-400 italic">Select Units</option>
            <template x-for="unit in units" :key="unit">
                <option :value="unit" x-text="unit"></option>
            </template>
            </select>

            <button
            @click="removeSubject(yearIndex, subjIndex)"
            class="sm:col-span-1 text-red-500 hover:text-red-700 text-xl w-full text-left sm:text-center"
            >
            &times;
            </button>
        </div>
        </template>


          <div class="mt-4 text-sm leading-relaxed">
            GWA:
            <span class="font-semibold" x-text="calculateGWA(year.subjects) || '0.00'"></span>
          </div>
        </div>
      </template>

      <div class="text-center mb-12 leading-relaxed">
        <button
          @click="addYear()"
          class="button px-6 py-2 bg-blue-600 text-white rounded-full shadow hover:bg-blue-700 transition-soft"
        >
          ➕ Add Year
        </button>
      </div>

    </div>
  </div>


  <footer
    x-data="{ showQR: false }"
    class="fixed bottom-4 left-0 right-0 z-50 flex justify-center px-4 text-gray-500 dark:text-gray-400 text-base"
  >
    <div class="flex flex-wrap items-center justify-center gap-4 bg-white dark:bg-[#1e293b] px-6 py-3 rounded-full shadow-md max-w-lg w-full font-medium">
      <p class="text-center">
        © 2025
        <a href="https://www.facebook.com/alfred.cabatoii" target="_blank" rel="noopener noreferrer"
          class="text-blue-600 dark:text-blue-400 hover:underline font-semibold">
          Alfred C. Cabato
        </a>
      </p>

      <button
        @click="showQR = true"
        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-5 rounded-full whitespace-nowrap text-base"
      >
        Penge Piso
      </button>
    </div>

    <div
      x-show="showQR"
      @click.outside="showQR = false"
      x-cloak
      class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4"
    >
      <div class="bg-white dark:bg-gray-800 rounded-xl p-4 max-w-[250px] sm:max-w-[280px] w-full text-center relative shadow-lg text-sm">
        <button
          @click="showQR = false"
          class="absolute top-2 right-2 text-red-600 hover:text-red-800 text-2xl font-bold"
        >×</button>
        <h2 class="text-lg font-semibold mb-4 dark:text-white">Scan GCash QR</h2>
        <img src="gcash.jpg" alt="GCash QR Code" class="w-full h-auto rounded-md border-2 border-blue-500" />
      </div>
    </div>
  </footer>

  <script>
    function gwaApp() {
      return {
        years: [],
        grades: [1.0, 1.25, 1.5, 1.75, 2.0, 2.25, 2.5, 2.75, 3.0, 4.0, 5.0],
        units: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
        overallGWA: null,
        honorText: "",
        theme: localStorage.getItem('theme') || 'light',

        init() {
          this.years = [
            {
              id: Date.now() + Math.random(),
              subjects: [
                { id: Date.now() + Math.random(), name: "", grade: "", units: "" }
              ]
            }
          ];
          this.calculateOverallGWA();
          document.documentElement.classList.toggle('dark', this.theme === 'dark');
        },

        toggleTheme() {
          this.theme = this.theme === 'dark' ? 'light' : 'dark';
          localStorage.setItem('theme', this.theme);
          document.documentElement.classList.toggle('dark', this.theme === 'dark');
        },

        calculateGWA(subjects) {
          let totalUnits = 0, totalWeighted = 0;
          subjects.forEach((s) => {
            if (s.grade && s.units) {
              totalUnits += parseFloat(s.units);
              totalWeighted += parseFloat(s.grade) * parseFloat(s.units);
            }
          });
          const gwa = totalUnits ? (totalWeighted / totalUnits).toFixed(2) : null;
          this.calculateOverallGWA();
          return gwa;
        },

        calculateOverallGWA() {
          let allSubjects = [];
          this.years.forEach((y) => allSubjects.push(...y.subjects));
          let totalUnits = 0, totalWeighted = 0;
          allSubjects.forEach((s) => {
            if (s.grade && s.units) {
              totalUnits += parseFloat(s.units);
              totalWeighted += parseFloat(s.grade) * parseFloat(s.units);
            }
          });
          this.overallGWA = totalUnits ? (totalWeighted / totalUnits).toFixed(2) : null;

          if (this.overallGWA) {
            const gwa = parseFloat(this.overallGWA);
            if (gwa <= 1.2) this.honorText = "Summa Cum Laude";
            else if (gwa <= 1.45) this.honorText = "Magna Cum Laude";
            else if (gwa <= 1.75) this.honorText = "Cum Laude";
            else this.honorText = "No Latin Honor";
          } else {
            this.honorText = "";
          }
        },

        addYear() {
          this.years.push({ id: Date.now() + Math.random(), subjects: [] });
        },

        addSubject(yearIndex) {
          this.years[yearIndex].subjects.push({ id: Date.now() + Math.random(), name: "", grade: "", units: "" });
        },

        removeSubject(yearIndex, subjIndex) {
          this.years[yearIndex].subjects.splice(subjIndex, 1);
          this.calculateOverallGWA();
        },

        getOrdinalYear(n) {
          const suffixes = ["th", "st", "nd", "rd"];
          const v = n % 100;
          return n + (suffixes[(v - 20) % 10] || suffixes[v] || suffixes[0]);
        },
      };
    }
  </script>
</body>
</html>
